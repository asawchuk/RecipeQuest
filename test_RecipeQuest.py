import pytest
import mock
import __builtin__
import RecipeQuest
import requests

rq = RecipeQuest.RecipeQuest()


def test_user_ingredients():
    with mock.patch.object(__builtin__, 'raw_input', lambda d: 'eggs, chicken breast'):
        assert rq.prompt_user_for_ingredients() is True
        assert rq.user_ingredients == ['eggs', 'chicken breast']
    assert rq.get_user_ingredients() == ['eggs', 'chicken breast']


def test_user_ingredients_no_entry():
    with mock.patch.object(__builtin__, 'raw_input', lambda d: ''):
        assert rq.prompt_user_for_ingredients() is False
        assert rq.user_ingredients == []
    assert rq.get_user_ingredients() == []


def test_build_url():
    api = RecipeQuest.RESTAPI("testkey")
    url_params = {'a': 'b',
                  'c': 'd',
                  'e': 'f',
                  'g': 'h',
                  'hij': 'lmnop',
                  'xyz': '123.456!789'}
    base_url = 'http://testsite.com/dosomething'
    assert api.build_url(base_url, url_params) == \
           'http://testsite.com/dosomething?key=testkey&a=b&c=d&e=f&g=h&xyz=123.456%21789&hij=lmnop'


def test_build_url_no_params():
    api = RecipeQuest.RESTAPI("testkey")
    url_params = {}
    base_url = 'http://testsite.com/dosomethingelse'
    assert api.build_url(base_url, url_params) == \
           'http://testsite.com/dosomethingelse?key=testkey'


def test_make_request(monkeypatch):
    test_json = '{"count": 30, "recipes": [{"publisher": "Chow", "f2f_url": "http://food2fork.com/view/7b468a", "title": "Chicken Parmesan Recipe", "source_url": "http://www.chow.com/recipes/10954-chicken-parmesan", "recipe_id": "7b468a", "image_url": "http://static.food2fork.com/10954_RecipeImag_620x413_chicken_parmesan_20e1a.jpg", "social_rank": 99.89454125565118, "publisher_url": "http://www.chow.com"}, {"publisher": "BBC Food", "f2f_url": "http://food2fork.com/view/c5bbdc", "title": "Chicken and mushroom pie", "source_url": "http://www.bbc.co.uk/food/recipes/chickenandmushroompi_89034", "recipe_id": "c5bbdc", "image_url": "http://static.food2fork.com/chickenandmushroompi_89034_16x97006.jpg", "social_rank": 99.73898187414173, "publisher_url": "http://www.bbc.co.uk/food"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/d491b9", "title": "Summer sausage rolls", "source_url": "http://www.bbcgoodfood.com/recipes/11610/summer-sausage-rolls", "recipe_id": "d491b9", "image_url": "http://static.food2fork.com/11610_MEDIUMc500.jpg", "social_rank": 97.50049678455784, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Food", "f2f_url": "http://food2fork.com/view/8c0314", "title": "Chicken and cashew nut stir-fry", "source_url": "http://www.bbc.co.uk/food/recipes/chickenandcashewnuts_89299", "recipe_id": "8c0314", "image_url": "http://static.food2fork.com/chickenandcashewnuts_89299_16x9986b.jpg", "social_rank": 95.91061636245128, "publisher_url": "http://www.bbc.co.uk/food"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/28674", "title": "Simply Parmesan Chicken", "source_url": "http://allrecipes.com/Recipe/Simply-Parmesan-Chicken/Detail.aspx", "recipe_id": "28674", "image_url": "http://static.food2fork.com/1768256a59.jpg", "social_rank": 93.80034906530031, "publisher_url": "http://allrecipes.com"}, {"publisher": "Bon Appetit", "f2f_url": "http://food2fork.com/view/51439", "title": "Chicken Parmesan", "source_url": "http://www.bonappetit.com/recipes/2008/09/chicken_parmesan", "recipe_id": "51439", "image_url": "http://static.food2fork.com/mare_chicken_parmesan_h176c.jpg", "social_rank": 90.59575791272333, "publisher_url": "http://www.bonappetit.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/c332f0", "title": "Posh chicken nuggets", "source_url": "http://www.bbcgoodfood.com/recipes/1562652/posh-chicken-nuggets", "recipe_id": "c332f0", "image_url": "http://static.food2fork.com/1562652_MEDIUM1004.jpg", "social_rank": 89.42509401242557, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/a4042b", "title": "Chicken &amp; Sweetcorn Soup", "source_url": "http://www.bbcgoodfood.com/recipes/180619/chicken-and-sweetcorn-soup", "recipe_id": "a4042b", "image_url": "http://static.food2fork.com/197075_medium0a7a.jpg", "social_rank": 89.3240030128329, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/93f36c", "title": "Christmas pie", "source_url": "http://www.bbcgoodfood.com/recipes/2793/christmas-pie", "recipe_id": "93f36c", "image_url": "http://static.food2fork.com/2793_MEDIUMaa84.jpg", "social_rank": 83.76867154251453, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "Whats Gaby Cooking", "f2f_url": "http://food2fork.com/view/bf98a7", "title": "Chicken Parmesan Pizza", "source_url": "http://whatsgabycooking.com/chicken-parmesan-pizza/", "recipe_id": "bf98a7", "image_url": "http://static.food2fork.com/ChickenParmesanPizza347d.jpg", "social_rank": 73.2532994368836, "publisher_url": "http://whatsgabycooking.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/ee30da", "title": "Roast chicken with couscous &amp; pine nut stuffing", "source_url": "http://www.bbcgoodfood.com/recipes/4631/roast-chicken-with-couscous-and-pine-nut-stuffing", "recipe_id": "ee30da", "image_url": "http://static.food2fork.com/4631_MEDIUMd62c.jpg", "social_rank": 70.0614349403127, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Food", "f2f_url": "http://food2fork.com/view/d7f6b6", "title": "Chicken Caesar salad", "source_url": "http://www.bbc.co.uk/food/recipes/chickencaesarsalad_84099", "recipe_id": "d7f6b6", "image_url": "http://static.food2fork.com/chickencaesarsalad_84099_16x94a30.jpg", "social_rank": 67.68672624618944, "publisher_url": "http://www.bbc.co.uk/food"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/9035", "title": "Cobb Sandwich", "source_url": "http://allrecipes.com/Recipe/Cobb-Sandwich/Detail.aspx", "recipe_id": "9035", "image_url": "http://static.food2fork.com/837140358c.jpg", "social_rank": 59.0766006079401, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/28c523", "title": "Superhealthy Singapore noodles", "source_url": "http://www.bbcgoodfood.com/recipes/1088636/superhealthy-singapore-noodles", "recipe_id": "28c523", "image_url": "http://static.food2fork.com/1088636_MEDIUMcbca.jpg", "social_rank": 57.38336112249029, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/819c7a", "title": "Chicken &amp; ham sandwich pies", "source_url": "http://www.bbcgoodfood.com/recipes/1403640/chicken-and-ham-sandwich-pies", "recipe_id": "819c7a", "image_url": "http://static.food2fork.com/1403640_MEDIUMf0f6.jpg", "social_rank": 57.35869506571309, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/10624", "title": "Crispy Crunchy Chicken Strips", "source_url": "http://allrecipes.com/Recipe/Crispy-Crunchy-Chicken-Strips/Detail.aspx", "recipe_id": "10624", "image_url": "http://static.food2fork.com/8052750e2e.jpg", "social_rank": 48.80530293498088, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/c82344", "title": "Four &amp; twenty chicken &amp; ham pie", "source_url": "http://www.bbcgoodfood.com/recipes/2762678/four-and-twenty-chicken-and-ham-pie", "recipe_id": "c82344", "image_url": "http://static.food2fork.com/2762678_MEDIUM6186.jpg", "social_rank": 47.57327788473348, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/519", "title": "&#34;Pantry Raid&#34; Chicken Enchilada Casserole", "source_url": "http://allrecipes.com/Recipe/Pantry-Raid-Chicken-Enchilada-Casserole/Detail.aspx", "recipe_id": "519", "image_url": "http://static.food2fork.com/8368150356.jpg", "social_rank": 47.4115523494645, "publisher_url": "http://allrecipes.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/e31b11", "title": "Baked Honey Nut Chicken", "source_url": "http://allrecipes.com/Recipe/Baked-Honey-Nut-Chicken/Detail.aspx", "recipe_id": "e31b11", "image_url": "http://static.food2fork.com/64461e0fa.jpg", "social_rank": 44.36064851437235, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/aa3374", "title": "Caribbean BBQ Patties", "source_url": "http://www.bbcgoodfood.com/recipes/1644634/caribbean-bbq-patties", "recipe_id": "aa3374", "image_url": "http://static.food2fork.com/1066129_medium5a98.jpg", "social_rank": 43.990595311222, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "What\'s Gaby Cooking", "f2f_url": "http://food2fork.com/view/2ae036", "title": "Chicken Piccata", "source_url": "http://whatsgabycooking.com/chicken-piccata/", "recipe_id": "2ae036", "image_url": "http://static.food2fork.com/IMG_0971209e.jpg", "social_rank": 42.98054251543119, "publisher_url": "http://whatsgabycooking.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/7301", "title": "Chicken Meatball Soup", "source_url": "http://allrecipes.com/Recipe/Chicken-Meatball-Soup/Detail.aspx", "recipe_id": "7301", "image_url": "http://static.food2fork.com/11115fd4.jpg", "social_rank": 40.82743438986167, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/bcddbc", "title": "Crunchy chicken strips", "source_url": "http://www.bbcgoodfood.com/recipes/5071/crunchy-chicken-strips", "recipe_id": "bcddbc", "image_url": "http://static.food2fork.com/5071_MEDIUMc570.jpg", "social_rank": 38.58882214853294, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/7375", "title": "Chicken Piccata I", "source_url": "http://allrecipes.com/Recipe/Chicken-Piccata-I/Detail.aspx", "recipe_id": "7375", "image_url": "http://static.food2fork.com/775766dbbc.jpg", "social_rank": 38.58334825401263, "publisher_url": "http://allrecipes.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/32664", "title": "Three Pepper Chicken", "source_url": "http://allrecipes.com/Recipe/Three-Pepper-Chicken/Detail.aspx", "recipe_id": "32664", "image_url": "http://static.food2fork.com/294182c694.jpg", "social_rank": 37.296487944001576, "publisher_url": "http://allrecipes.com"}, {"publisher": "Fine Dining Lovers", "f2f_url": "http://food2fork.com/view/54016", "title": "Chicken And Shrimp Salad With Vegetables And Noodles", "source_url": "http://www.finedininglovers.com/recipes/brunch/asian-noodle-salad-recipe/", "recipe_id": "54016", "image_url": "http://static.food2fork.com/s_1494_chickenshrimpnoodlesaladCUT16e97.jpg", "social_rank": 36.74270627824756, "publisher_url": "http://www.finedininglovers.com"}, {"publisher": "Cookstr", "f2f_url": "http://food2fork.com/view/45970", "title": "Pineapple Fried Rice", "source_url": "http://www.cookstr.com/recipes/pineapple-fried-rice", "recipe_id": "45970", "image_url": "http://static.food2fork.com/recipe19925e0d3.jpg", "social_rank": 36.62681759006754, "publisher_url": "http://www.cookstr.com"}, {"publisher": "Fine Dining Lovers", "f2f_url": "http://food2fork.com/view/53773", "title": "Asian Cashewnuts and Chicken Stir Fry", "source_url": "http://www.finedininglovers.com/recipes/main-course/cashewnuts-chicken-stir-fry/", "recipe_id": "53773", "image_url": "http://static.food2fork.com/s_3605_StockFood00166777cut5816.jpg", "social_rank": 36.61058866469593, "publisher_url": "http://www.finedininglovers.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/7686", "title": "Chili And Cheese Stuffed Chicken Breasts", "source_url": "http://allrecipes.com/Recipe/Chili-And-Cheese-Stuffed-Chicken-Breasts/Detail.aspx", "recipe_id": "7686", "image_url": "http://static.food2fork.com/5042754ad0.jpg", "social_rank": 36.27011876765954, "publisher_url": "http://allrecipes.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/1b6c2d", "title": "My Chicken Parmesan", "source_url": "http://allrecipes.com/Recipe/My-Chicken-Parmesan/Detail.aspx", "recipe_id": "1b6c2d", "image_url": "http://static.food2fork.com/1002005b5ee.jpg", "social_rank": 34.94538081677452, "publisher_url": "http://allrecipes.com"}]}'
    api = RecipeQuest.RESTAPI("testkey")
    def mock_requests_get(uri, *args, **kwargs):
        obj = type('MockedResp', (), {})()
        obj.status_code = 200
        obj.content = test_json
        return obj
    monkeypatch.setattr(requests, 'get', mock_requests_get)
    recipes_json = api.make_request('http://somewhere', {})
    assert recipes_json == test_json


def test_make_request_404(monkeypatch):
    test_json = '{"count": 30, "recipes": [{"publisher": "Chow", "f2f_url": "http://food2fork.com/view/7b468a", "title": "Chicken Parmesan Recipe", "source_url": "http://www.chow.com/recipes/10954-chicken-parmesan", "recipe_id": "7b468a", "image_url": "http://static.food2fork.com/10954_RecipeImag_620x413_chicken_parmesan_20e1a.jpg", "social_rank": 99.89454125565118, "publisher_url": "http://www.chow.com"}, {"publisher": "BBC Food", "f2f_url": "http://food2fork.com/view/c5bbdc", "title": "Chicken and mushroom pie", "source_url": "http://www.bbc.co.uk/food/recipes/chickenandmushroompi_89034", "recipe_id": "c5bbdc", "image_url": "http://static.food2fork.com/chickenandmushroompi_89034_16x97006.jpg", "social_rank": 99.73898187414173, "publisher_url": "http://www.bbc.co.uk/food"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/d491b9", "title": "Summer sausage rolls", "source_url": "http://www.bbcgoodfood.com/recipes/11610/summer-sausage-rolls", "recipe_id": "d491b9", "image_url": "http://static.food2fork.com/11610_MEDIUMc500.jpg", "social_rank": 97.50049678455784, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Food", "f2f_url": "http://food2fork.com/view/8c0314", "title": "Chicken and cashew nut stir-fry", "source_url": "http://www.bbc.co.uk/food/recipes/chickenandcashewnuts_89299", "recipe_id": "8c0314", "image_url": "http://static.food2fork.com/chickenandcashewnuts_89299_16x9986b.jpg", "social_rank": 95.91061636245128, "publisher_url": "http://www.bbc.co.uk/food"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/28674", "title": "Simply Parmesan Chicken", "source_url": "http://allrecipes.com/Recipe/Simply-Parmesan-Chicken/Detail.aspx", "recipe_id": "28674", "image_url": "http://static.food2fork.com/1768256a59.jpg", "social_rank": 93.80034906530031, "publisher_url": "http://allrecipes.com"}, {"publisher": "Bon Appetit", "f2f_url": "http://food2fork.com/view/51439", "title": "Chicken Parmesan", "source_url": "http://www.bonappetit.com/recipes/2008/09/chicken_parmesan", "recipe_id": "51439", "image_url": "http://static.food2fork.com/mare_chicken_parmesan_h176c.jpg", "social_rank": 90.59575791272333, "publisher_url": "http://www.bonappetit.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/c332f0", "title": "Posh chicken nuggets", "source_url": "http://www.bbcgoodfood.com/recipes/1562652/posh-chicken-nuggets", "recipe_id": "c332f0", "image_url": "http://static.food2fork.com/1562652_MEDIUM1004.jpg", "social_rank": 89.42509401242557, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/a4042b", "title": "Chicken &amp; Sweetcorn Soup", "source_url": "http://www.bbcgoodfood.com/recipes/180619/chicken-and-sweetcorn-soup", "recipe_id": "a4042b", "image_url": "http://static.food2fork.com/197075_medium0a7a.jpg", "social_rank": 89.3240030128329, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/93f36c", "title": "Christmas pie", "source_url": "http://www.bbcgoodfood.com/recipes/2793/christmas-pie", "recipe_id": "93f36c", "image_url": "http://static.food2fork.com/2793_MEDIUMaa84.jpg", "social_rank": 83.76867154251453, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "Whats Gaby Cooking", "f2f_url": "http://food2fork.com/view/bf98a7", "title": "Chicken Parmesan Pizza", "source_url": "http://whatsgabycooking.com/chicken-parmesan-pizza/", "recipe_id": "bf98a7", "image_url": "http://static.food2fork.com/ChickenParmesanPizza347d.jpg", "social_rank": 73.2532994368836, "publisher_url": "http://whatsgabycooking.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/ee30da", "title": "Roast chicken with couscous &amp; pine nut stuffing", "source_url": "http://www.bbcgoodfood.com/recipes/4631/roast-chicken-with-couscous-and-pine-nut-stuffing", "recipe_id": "ee30da", "image_url": "http://static.food2fork.com/4631_MEDIUMd62c.jpg", "social_rank": 70.0614349403127, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Food", "f2f_url": "http://food2fork.com/view/d7f6b6", "title": "Chicken Caesar salad", "source_url": "http://www.bbc.co.uk/food/recipes/chickencaesarsalad_84099", "recipe_id": "d7f6b6", "image_url": "http://static.food2fork.com/chickencaesarsalad_84099_16x94a30.jpg", "social_rank": 67.68672624618944, "publisher_url": "http://www.bbc.co.uk/food"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/9035", "title": "Cobb Sandwich", "source_url": "http://allrecipes.com/Recipe/Cobb-Sandwich/Detail.aspx", "recipe_id": "9035", "image_url": "http://static.food2fork.com/837140358c.jpg", "social_rank": 59.0766006079401, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/28c523", "title": "Superhealthy Singapore noodles", "source_url": "http://www.bbcgoodfood.com/recipes/1088636/superhealthy-singapore-noodles", "recipe_id": "28c523", "image_url": "http://static.food2fork.com/1088636_MEDIUMcbca.jpg", "social_rank": 57.38336112249029, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/819c7a", "title": "Chicken &amp; ham sandwich pies", "source_url": "http://www.bbcgoodfood.com/recipes/1403640/chicken-and-ham-sandwich-pies", "recipe_id": "819c7a", "image_url": "http://static.food2fork.com/1403640_MEDIUMf0f6.jpg", "social_rank": 57.35869506571309, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/10624", "title": "Crispy Crunchy Chicken Strips", "source_url": "http://allrecipes.com/Recipe/Crispy-Crunchy-Chicken-Strips/Detail.aspx", "recipe_id": "10624", "image_url": "http://static.food2fork.com/8052750e2e.jpg", "social_rank": 48.80530293498088, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/c82344", "title": "Four &amp; twenty chicken &amp; ham pie", "source_url": "http://www.bbcgoodfood.com/recipes/2762678/four-and-twenty-chicken-and-ham-pie", "recipe_id": "c82344", "image_url": "http://static.food2fork.com/2762678_MEDIUM6186.jpg", "social_rank": 47.57327788473348, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/519", "title": "&#34;Pantry Raid&#34; Chicken Enchilada Casserole", "source_url": "http://allrecipes.com/Recipe/Pantry-Raid-Chicken-Enchilada-Casserole/Detail.aspx", "recipe_id": "519", "image_url": "http://static.food2fork.com/8368150356.jpg", "social_rank": 47.4115523494645, "publisher_url": "http://allrecipes.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/e31b11", "title": "Baked Honey Nut Chicken", "source_url": "http://allrecipes.com/Recipe/Baked-Honey-Nut-Chicken/Detail.aspx", "recipe_id": "e31b11", "image_url": "http://static.food2fork.com/64461e0fa.jpg", "social_rank": 44.36064851437235, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/aa3374", "title": "Caribbean BBQ Patties", "source_url": "http://www.bbcgoodfood.com/recipes/1644634/caribbean-bbq-patties", "recipe_id": "aa3374", "image_url": "http://static.food2fork.com/1066129_medium5a98.jpg", "social_rank": 43.990595311222, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "What\'s Gaby Cooking", "f2f_url": "http://food2fork.com/view/2ae036", "title": "Chicken Piccata", "source_url": "http://whatsgabycooking.com/chicken-piccata/", "recipe_id": "2ae036", "image_url": "http://static.food2fork.com/IMG_0971209e.jpg", "social_rank": 42.98054251543119, "publisher_url": "http://whatsgabycooking.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/7301", "title": "Chicken Meatball Soup", "source_url": "http://allrecipes.com/Recipe/Chicken-Meatball-Soup/Detail.aspx", "recipe_id": "7301", "image_url": "http://static.food2fork.com/11115fd4.jpg", "social_rank": 40.82743438986167, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/bcddbc", "title": "Crunchy chicken strips", "source_url": "http://www.bbcgoodfood.com/recipes/5071/crunchy-chicken-strips", "recipe_id": "bcddbc", "image_url": "http://static.food2fork.com/5071_MEDIUMc570.jpg", "social_rank": 38.58882214853294, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/7375", "title": "Chicken Piccata I", "source_url": "http://allrecipes.com/Recipe/Chicken-Piccata-I/Detail.aspx", "recipe_id": "7375", "image_url": "http://static.food2fork.com/775766dbbc.jpg", "social_rank": 38.58334825401263, "publisher_url": "http://allrecipes.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/32664", "title": "Three Pepper Chicken", "source_url": "http://allrecipes.com/Recipe/Three-Pepper-Chicken/Detail.aspx", "recipe_id": "32664", "image_url": "http://static.food2fork.com/294182c694.jpg", "social_rank": 37.296487944001576, "publisher_url": "http://allrecipes.com"}, {"publisher": "Fine Dining Lovers", "f2f_url": "http://food2fork.com/view/54016", "title": "Chicken And Shrimp Salad With Vegetables And Noodles", "source_url": "http://www.finedininglovers.com/recipes/brunch/asian-noodle-salad-recipe/", "recipe_id": "54016", "image_url": "http://static.food2fork.com/s_1494_chickenshrimpnoodlesaladCUT16e97.jpg", "social_rank": 36.74270627824756, "publisher_url": "http://www.finedininglovers.com"}, {"publisher": "Cookstr", "f2f_url": "http://food2fork.com/view/45970", "title": "Pineapple Fried Rice", "source_url": "http://www.cookstr.com/recipes/pineapple-fried-rice", "recipe_id": "45970", "image_url": "http://static.food2fork.com/recipe19925e0d3.jpg", "social_rank": 36.62681759006754, "publisher_url": "http://www.cookstr.com"}, {"publisher": "Fine Dining Lovers", "f2f_url": "http://food2fork.com/view/53773", "title": "Asian Cashewnuts and Chicken Stir Fry", "source_url": "http://www.finedininglovers.com/recipes/main-course/cashewnuts-chicken-stir-fry/", "recipe_id": "53773", "image_url": "http://static.food2fork.com/s_3605_StockFood00166777cut5816.jpg", "social_rank": 36.61058866469593, "publisher_url": "http://www.finedininglovers.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/7686", "title": "Chili And Cheese Stuffed Chicken Breasts", "source_url": "http://allrecipes.com/Recipe/Chili-And-Cheese-Stuffed-Chicken-Breasts/Detail.aspx", "recipe_id": "7686", "image_url": "http://static.food2fork.com/5042754ad0.jpg", "social_rank": 36.27011876765954, "publisher_url": "http://allrecipes.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/1b6c2d", "title": "My Chicken Parmesan", "source_url": "http://allrecipes.com/Recipe/My-Chicken-Parmesan/Detail.aspx", "recipe_id": "1b6c2d", "image_url": "http://static.food2fork.com/1002005b5ee.jpg", "social_rank": 34.94538081677452, "publisher_url": "http://allrecipes.com"}]}'
    api = RecipeQuest.RESTAPI("testkey")

    def mock_requests_get(uri, *args, **kwargs):
        obj = type('MockedResp', (), {})()
        obj.status_code = 404
        obj.content = test_json
        return obj

    monkeypatch.setattr(requests, 'get', mock_requests_get)
    recipes_json = api.make_request('http://somewhere', {})
    assert recipes_json == ''


def test_make_request_no_content(monkeypatch):
    api = RecipeQuest.RESTAPI("testkey")

    def mock_requests_get(uri, *args, **kwargs):
        obj = type('MockedResp', (), {})()
        obj.status_code = 200
        obj.content = ''
        return obj

    monkeypatch.setattr(requests, 'get', mock_requests_get)
    recipes_json = api.make_request('http://somewhere', {})
    assert recipes_json == ''


def test_recipe_lookup_ingredients(monkeypatch):
    def mock_requests_get(uri, *args, **kwargs):
        obj = type('MockedResp', (), {})()
        obj.status_code = 200
        obj.content = ''
        return obj

    monkeypatch.setattr(requests, 'get', mock_requests_get)
    recipe = RecipeQuest.Recipe('testid')
    assert recipe.lookup_ingredients() is False


def test_recipe_lookup_ingredients_json_array(monkeypatch):
    test_json = '["recipe1", "recipe2"]'
    def mock_requests_get(uri, *args, **kwargs):
        obj = type('MockedResp', (), {})()
        obj.status_code = 200
        obj.content = test_json
        return obj

    monkeypatch.setattr(requests, 'get', mock_requests_get)
    recipe = RecipeQuest.Recipe('testid')
    assert recipe.lookup_ingredients() is False


def test_recipe_lookup_ingredients_unexpected_format(monkeypatch):
    test_json = '{"recipe2": {"publisher": "Chow", "f2f_url": "http://food2fork.com/view/7b468a", "ingredients": ["3 (11- to 12-ounce) boneless, skinless chicken breasts", "Salt", "Freshly ground black pepper", "3/4 cup all-purpose flour", "3/4 cup whole milk", "2 large eggs, beaten", "1 1/2 cups panko", "1/2 cup finely grated Parmesan cheese (about 1/2 ounce)", "1 cup olive oil", "3 cups", "1/2 cup thinly sliced fresh basil leaves (about 20 medium leaves)", "8 ounces fresh mozzarella, cut into 12 thin slices"], "source_url": "http://www.chow.com/recipes/10954-chicken-parmesan", "recipe_id": "7b468a", "image_url": "http://static.food2fork.com/10954_RecipeImag_620x413_chicken_parmesan_20e1a.jpg", "social_rank": 99.89454125565118, "publisher_url": "http://www.chow.com", "title": "Chicken Parmesan Recipe"}}'
    def mock_requests_get(uri, *args, **kwargs):
        obj = type('MockedResp', (), {})()
        obj.status_code = 200
        obj.content = test_json
        return obj

    monkeypatch.setattr(requests, 'get', mock_requests_get)
    recipe = RecipeQuest.Recipe('testid')
    assert recipe.lookup_ingredients() is False


def test_recipe_lookup_ingredients_malformed_json(monkeypatch):
    test_json = '{"recipe'
    def mock_requests_get(uri, *args, **kwargs):
        obj = type('MockedResp', (), {})()
        obj.status_code = 200
        obj.content = test_json
        return obj

    monkeypatch.setattr(requests, 'get', mock_requests_get)
    recipe = RecipeQuest.Recipe('testid')
    assert recipe.lookup_ingredients() is False


def test_recipe_lookup_ingredients(monkeypatch):
    test_json = '{"recipe": {"publisher": "Chow", "f2f_url": "http://food2fork.com/view/7b468a", "ingredients": ["3 (11- to 12-ounce) boneless, skinless chicken breasts", "Salt", "Freshly ground black pepper", "3/4 cup all-purpose flour", "3/4 cup whole milk", "2 large eggs, beaten", "1 1/2 cups panko", "1/2 cup finely grated Parmesan cheese (about 1/2 ounce)", "1 cup olive oil", "3 cups", "1/2 cup thinly sliced fresh basil leaves (about 20 medium leaves)", "8 ounces fresh mozzarella, cut into 12 thin slices"], "source_url": "http://www.chow.com/recipes/10954-chicken-parmesan", "recipe_id": "7b468a", "image_url": "http://static.food2fork.com/10954_RecipeImag_620x413_chicken_parmesan_20e1a.jpg", "social_rank": 99.89454125565118, "publisher_url": "http://www.chow.com", "title": "Chicken Parmesan Recipe"}}'
    def mock_requests_get(uri, *args, **kwargs):
        obj = type('MockedResp', (), {})()
        obj.status_code = 200
        obj.content = test_json
        return obj

    monkeypatch.setattr(requests, 'get', mock_requests_get)
    recipe = RecipeQuest.Recipe('testid')
    assert recipe.lookup_ingredients() is True
    assert recipe.get_f2f_url() == 'http://food2fork.com/view/7b468a'
    assert recipe.get_title() == 'Chicken Parmesan Recipe'
    assert recipe.ingredients == ["3 (11- to 12-ounce) boneless, skinless chicken breasts", "Salt", "Freshly ground black pepper", "3/4 cup all-purpose flour", "3/4 cup whole milk", "2 large eggs, beaten", "1 1/2 cups panko", "1/2 cup finely grated Parmesan cheese (about 1/2 ounce)", "1 cup olive oil", "3 cups", "1/2 cup thinly sliced fresh basil leaves (about 20 medium leaves)", "8 ounces fresh mozzarella, cut into 12 thin slices"]


def test_recipe_compute_missing_ingredients():
    recipe = RecipeQuest.Recipe('testid')
    recipe.ingredients = ['salt', 'pepper', 'eggs', 'chicken breasts']
    assert recipe.compute_missing_ingredients(['salt', 'pepper']) == ['eggs', 'chicken breasts']
    assert recipe.compute_missing_ingredients(['salt', 'pepper', 'chicken breast']) == ['eggs']
    assert recipe.compute_missing_ingredients(['salt', 'pepper', 'eggs', 'chicken breast']) == []
    assert recipe.compute_missing_ingredients([]) == ['salt', 'pepper', 'eggs', 'chicken breasts']


def test_parse_recipe_list():
    test_json = '{"count": 30, "recipes": [{"publisher": "Chow", "f2f_url": "http://food2fork.com/view/7b468a", "title": "Chicken Parmesan Recipe", "source_url": "http://www.chow.com/recipes/10954-chicken-parmesan", "recipe_id": "7b468a", "image_url": "http://static.food2fork.com/10954_RecipeImag_620x413_chicken_parmesan_20e1a.jpg", "social_rank": 99.89454125565118, "publisher_url": "http://www.chow.com"}, {"publisher": "BBC Food", "f2f_url": "http://food2fork.com/view/c5bbdc", "title": "Chicken and mushroom pie", "source_url": "http://www.bbc.co.uk/food/recipes/chickenandmushroompi_89034", "recipe_id": "c5bbdc", "image_url": "http://static.food2fork.com/chickenandmushroompi_89034_16x97006.jpg", "social_rank": 99.73898187414173, "publisher_url": "http://www.bbc.co.uk/food"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/d491b9", "title": "Summer sausage rolls", "source_url": "http://www.bbcgoodfood.com/recipes/11610/summer-sausage-rolls", "recipe_id": "d491b9", "image_url": "http://static.food2fork.com/11610_MEDIUMc500.jpg", "social_rank": 97.50049678455784, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Food", "f2f_url": "http://food2fork.com/view/8c0314", "title": "Chicken and cashew nut stir-fry", "source_url": "http://www.bbc.co.uk/food/recipes/chickenandcashewnuts_89299", "recipe_id": "8c0314", "image_url": "http://static.food2fork.com/chickenandcashewnuts_89299_16x9986b.jpg", "social_rank": 95.91061636245128, "publisher_url": "http://www.bbc.co.uk/food"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/28674", "title": "Simply Parmesan Chicken", "source_url": "http://allrecipes.com/Recipe/Simply-Parmesan-Chicken/Detail.aspx", "recipe_id": "28674", "image_url": "http://static.food2fork.com/1768256a59.jpg", "social_rank": 93.80034906530031, "publisher_url": "http://allrecipes.com"}, {"publisher": "Bon Appetit", "f2f_url": "http://food2fork.com/view/51439", "title": "Chicken Parmesan", "source_url": "http://www.bonappetit.com/recipes/2008/09/chicken_parmesan", "recipe_id": "51439", "image_url": "http://static.food2fork.com/mare_chicken_parmesan_h176c.jpg", "social_rank": 90.59575791272333, "publisher_url": "http://www.bonappetit.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/c332f0", "title": "Posh chicken nuggets", "source_url": "http://www.bbcgoodfood.com/recipes/1562652/posh-chicken-nuggets", "recipe_id": "c332f0", "image_url": "http://static.food2fork.com/1562652_MEDIUM1004.jpg", "social_rank": 89.42509401242557, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/a4042b", "title": "Chicken &amp; Sweetcorn Soup", "source_url": "http://www.bbcgoodfood.com/recipes/180619/chicken-and-sweetcorn-soup", "recipe_id": "a4042b", "image_url": "http://static.food2fork.com/197075_medium0a7a.jpg", "social_rank": 89.3240030128329, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/93f36c", "title": "Christmas pie", "source_url": "http://www.bbcgoodfood.com/recipes/2793/christmas-pie", "recipe_id": "93f36c", "image_url": "http://static.food2fork.com/2793_MEDIUMaa84.jpg", "social_rank": 83.76867154251453, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "Whats Gaby Cooking", "f2f_url": "http://food2fork.com/view/bf98a7", "title": "Chicken Parmesan Pizza", "source_url": "http://whatsgabycooking.com/chicken-parmesan-pizza/", "recipe_id": "bf98a7", "image_url": "http://static.food2fork.com/ChickenParmesanPizza347d.jpg", "social_rank": 73.2532994368836, "publisher_url": "http://whatsgabycooking.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/ee30da", "title": "Roast chicken with couscous &amp; pine nut stuffing", "source_url": "http://www.bbcgoodfood.com/recipes/4631/roast-chicken-with-couscous-and-pine-nut-stuffing", "recipe_id": "ee30da", "image_url": "http://static.food2fork.com/4631_MEDIUMd62c.jpg", "social_rank": 70.0614349403127, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Food", "f2f_url": "http://food2fork.com/view/d7f6b6", "title": "Chicken Caesar salad", "source_url": "http://www.bbc.co.uk/food/recipes/chickencaesarsalad_84099", "recipe_id": "d7f6b6", "image_url": "http://static.food2fork.com/chickencaesarsalad_84099_16x94a30.jpg", "social_rank": 67.68672624618944, "publisher_url": "http://www.bbc.co.uk/food"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/9035", "title": "Cobb Sandwich", "source_url": "http://allrecipes.com/Recipe/Cobb-Sandwich/Detail.aspx", "recipe_id": "9035", "image_url": "http://static.food2fork.com/837140358c.jpg", "social_rank": 59.0766006079401, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/28c523", "title": "Superhealthy Singapore noodles", "source_url": "http://www.bbcgoodfood.com/recipes/1088636/superhealthy-singapore-noodles", "recipe_id": "28c523", "image_url": "http://static.food2fork.com/1088636_MEDIUMcbca.jpg", "social_rank": 57.38336112249029, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/819c7a", "title": "Chicken &amp; ham sandwich pies", "source_url": "http://www.bbcgoodfood.com/recipes/1403640/chicken-and-ham-sandwich-pies", "recipe_id": "819c7a", "image_url": "http://static.food2fork.com/1403640_MEDIUMf0f6.jpg", "social_rank": 57.35869506571309, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/10624", "title": "Crispy Crunchy Chicken Strips", "source_url": "http://allrecipes.com/Recipe/Crispy-Crunchy-Chicken-Strips/Detail.aspx", "recipe_id": "10624", "image_url": "http://static.food2fork.com/8052750e2e.jpg", "social_rank": 48.80530293498088, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/c82344", "title": "Four &amp; twenty chicken &amp; ham pie", "source_url": "http://www.bbcgoodfood.com/recipes/2762678/four-and-twenty-chicken-and-ham-pie", "recipe_id": "c82344", "image_url": "http://static.food2fork.com/2762678_MEDIUM6186.jpg", "social_rank": 47.57327788473348, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/519", "title": "&#34;Pantry Raid&#34; Chicken Enchilada Casserole", "source_url": "http://allrecipes.com/Recipe/Pantry-Raid-Chicken-Enchilada-Casserole/Detail.aspx", "recipe_id": "519", "image_url": "http://static.food2fork.com/8368150356.jpg", "social_rank": 47.4115523494645, "publisher_url": "http://allrecipes.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/e31b11", "title": "Baked Honey Nut Chicken", "source_url": "http://allrecipes.com/Recipe/Baked-Honey-Nut-Chicken/Detail.aspx", "recipe_id": "e31b11", "image_url": "http://static.food2fork.com/64461e0fa.jpg", "social_rank": 44.36064851437235, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/aa3374", "title": "Caribbean BBQ Patties", "source_url": "http://www.bbcgoodfood.com/recipes/1644634/caribbean-bbq-patties", "recipe_id": "aa3374", "image_url": "http://static.food2fork.com/1066129_medium5a98.jpg", "social_rank": 43.990595311222, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "What\'s Gaby Cooking", "f2f_url": "http://food2fork.com/view/2ae036", "title": "Chicken Piccata", "source_url": "http://whatsgabycooking.com/chicken-piccata/", "recipe_id": "2ae036", "image_url": "http://static.food2fork.com/IMG_0971209e.jpg", "social_rank": 42.98054251543119, "publisher_url": "http://whatsgabycooking.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/7301", "title": "Chicken Meatball Soup", "source_url": "http://allrecipes.com/Recipe/Chicken-Meatball-Soup/Detail.aspx", "recipe_id": "7301", "image_url": "http://static.food2fork.com/11115fd4.jpg", "social_rank": 40.82743438986167, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/bcddbc", "title": "Crunchy chicken strips", "source_url": "http://www.bbcgoodfood.com/recipes/5071/crunchy-chicken-strips", "recipe_id": "bcddbc", "image_url": "http://static.food2fork.com/5071_MEDIUMc570.jpg", "social_rank": 38.58882214853294, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/7375", "title": "Chicken Piccata I", "source_url": "http://allrecipes.com/Recipe/Chicken-Piccata-I/Detail.aspx", "recipe_id": "7375", "image_url": "http://static.food2fork.com/775766dbbc.jpg", "social_rank": 38.58334825401263, "publisher_url": "http://allrecipes.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/32664", "title": "Three Pepper Chicken", "source_url": "http://allrecipes.com/Recipe/Three-Pepper-Chicken/Detail.aspx", "recipe_id": "32664", "image_url": "http://static.food2fork.com/294182c694.jpg", "social_rank": 37.296487944001576, "publisher_url": "http://allrecipes.com"}, {"publisher": "Fine Dining Lovers", "f2f_url": "http://food2fork.com/view/54016", "title": "Chicken And Shrimp Salad With Vegetables And Noodles", "source_url": "http://www.finedininglovers.com/recipes/brunch/asian-noodle-salad-recipe/", "recipe_id": "54016", "image_url": "http://static.food2fork.com/s_1494_chickenshrimpnoodlesaladCUT16e97.jpg", "social_rank": 36.74270627824756, "publisher_url": "http://www.finedininglovers.com"}, {"publisher": "Cookstr", "f2f_url": "http://food2fork.com/view/45970", "title": "Pineapple Fried Rice", "source_url": "http://www.cookstr.com/recipes/pineapple-fried-rice", "recipe_id": "45970", "image_url": "http://static.food2fork.com/recipe19925e0d3.jpg", "social_rank": 36.62681759006754, "publisher_url": "http://www.cookstr.com"}, {"publisher": "Fine Dining Lovers", "f2f_url": "http://food2fork.com/view/53773", "title": "Asian Cashewnuts and Chicken Stir Fry", "source_url": "http://www.finedininglovers.com/recipes/main-course/cashewnuts-chicken-stir-fry/", "recipe_id": "53773", "image_url": "http://static.food2fork.com/s_3605_StockFood00166777cut5816.jpg", "social_rank": 36.61058866469593, "publisher_url": "http://www.finedininglovers.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/7686", "title": "Chili And Cheese Stuffed Chicken Breasts", "source_url": "http://allrecipes.com/Recipe/Chili-And-Cheese-Stuffed-Chicken-Breasts/Detail.aspx", "recipe_id": "7686", "image_url": "http://static.food2fork.com/5042754ad0.jpg", "social_rank": 36.27011876765954, "publisher_url": "http://allrecipes.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/1b6c2d", "title": "My Chicken Parmesan", "source_url": "http://allrecipes.com/Recipe/My-Chicken-Parmesan/Detail.aspx", "recipe_id": "1b6c2d", "image_url": "http://static.food2fork.com/1002005b5ee.jpg", "social_rank": 34.94538081677452, "publisher_url": "http://allrecipes.com"}]}'
    recipes = RecipeQuest.parse_recipe_list(test_json)
    assert 'recipes' in recipes
    assert len(recipes['recipes']) == 30


def test_parse_recipe_list_malformed_json():
    test_json = '{"count"'
    recipes = RecipeQuest.parse_recipe_list(test_json)
    assert recipes == []


def test_parse_recipe_list_json_array():
    test_json = '["count", "dracula"]'
    recipes = RecipeQuest.parse_recipe_list(test_json)
    assert recipes == []


def test_find_recipes(monkeypatch):
    test_json = '{"count": 30, "recipes": [{"publisher": "Chow", "f2f_url": "http://food2fork.com/view/7b468a", "title": "Chicken Parmesan Recipe", "source_url": "http://www.chow.com/recipes/10954-chicken-parmesan", "recipe_id": "7b468a", "image_url": "http://static.food2fork.com/10954_RecipeImag_620x413_chicken_parmesan_20e1a.jpg", "social_rank": 99.89454125565118, "publisher_url": "http://www.chow.com"}, {"publisher": "BBC Food", "f2f_url": "http://food2fork.com/view/c5bbdc", "title": "Chicken and mushroom pie", "source_url": "http://www.bbc.co.uk/food/recipes/chickenandmushroompi_89034", "recipe_id": "c5bbdc", "image_url": "http://static.food2fork.com/chickenandmushroompi_89034_16x97006.jpg", "social_rank": 99.73898187414173, "publisher_url": "http://www.bbc.co.uk/food"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/d491b9", "title": "Summer sausage rolls", "source_url": "http://www.bbcgoodfood.com/recipes/11610/summer-sausage-rolls", "recipe_id": "d491b9", "image_url": "http://static.food2fork.com/11610_MEDIUMc500.jpg", "social_rank": 97.50049678455784, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Food", "f2f_url": "http://food2fork.com/view/8c0314", "title": "Chicken and cashew nut stir-fry", "source_url": "http://www.bbc.co.uk/food/recipes/chickenandcashewnuts_89299", "recipe_id": "8c0314", "image_url": "http://static.food2fork.com/chickenandcashewnuts_89299_16x9986b.jpg", "social_rank": 95.91061636245128, "publisher_url": "http://www.bbc.co.uk/food"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/28674", "title": "Simply Parmesan Chicken", "source_url": "http://allrecipes.com/Recipe/Simply-Parmesan-Chicken/Detail.aspx", "recipe_id": "28674", "image_url": "http://static.food2fork.com/1768256a59.jpg", "social_rank": 93.80034906530031, "publisher_url": "http://allrecipes.com"}, {"publisher": "Bon Appetit", "f2f_url": "http://food2fork.com/view/51439", "title": "Chicken Parmesan", "source_url": "http://www.bonappetit.com/recipes/2008/09/chicken_parmesan", "recipe_id": "51439", "image_url": "http://static.food2fork.com/mare_chicken_parmesan_h176c.jpg", "social_rank": 90.59575791272333, "publisher_url": "http://www.bonappetit.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/c332f0", "title": "Posh chicken nuggets", "source_url": "http://www.bbcgoodfood.com/recipes/1562652/posh-chicken-nuggets", "recipe_id": "c332f0", "image_url": "http://static.food2fork.com/1562652_MEDIUM1004.jpg", "social_rank": 89.42509401242557, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/a4042b", "title": "Chicken &amp; Sweetcorn Soup", "source_url": "http://www.bbcgoodfood.com/recipes/180619/chicken-and-sweetcorn-soup", "recipe_id": "a4042b", "image_url": "http://static.food2fork.com/197075_medium0a7a.jpg", "social_rank": 89.3240030128329, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/93f36c", "title": "Christmas pie", "source_url": "http://www.bbcgoodfood.com/recipes/2793/christmas-pie", "recipe_id": "93f36c", "image_url": "http://static.food2fork.com/2793_MEDIUMaa84.jpg", "social_rank": 83.76867154251453, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "Whats Gaby Cooking", "f2f_url": "http://food2fork.com/view/bf98a7", "title": "Chicken Parmesan Pizza", "source_url": "http://whatsgabycooking.com/chicken-parmesan-pizza/", "recipe_id": "bf98a7", "image_url": "http://static.food2fork.com/ChickenParmesanPizza347d.jpg", "social_rank": 73.2532994368836, "publisher_url": "http://whatsgabycooking.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/ee30da", "title": "Roast chicken with couscous &amp; pine nut stuffing", "source_url": "http://www.bbcgoodfood.com/recipes/4631/roast-chicken-with-couscous-and-pine-nut-stuffing", "recipe_id": "ee30da", "image_url": "http://static.food2fork.com/4631_MEDIUMd62c.jpg", "social_rank": 70.0614349403127, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Food", "f2f_url": "http://food2fork.com/view/d7f6b6", "title": "Chicken Caesar salad", "source_url": "http://www.bbc.co.uk/food/recipes/chickencaesarsalad_84099", "recipe_id": "d7f6b6", "image_url": "http://static.food2fork.com/chickencaesarsalad_84099_16x94a30.jpg", "social_rank": 67.68672624618944, "publisher_url": "http://www.bbc.co.uk/food"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/9035", "title": "Cobb Sandwich", "source_url": "http://allrecipes.com/Recipe/Cobb-Sandwich/Detail.aspx", "recipe_id": "9035", "image_url": "http://static.food2fork.com/837140358c.jpg", "social_rank": 59.0766006079401, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/28c523", "title": "Superhealthy Singapore noodles", "source_url": "http://www.bbcgoodfood.com/recipes/1088636/superhealthy-singapore-noodles", "recipe_id": "28c523", "image_url": "http://static.food2fork.com/1088636_MEDIUMcbca.jpg", "social_rank": 57.38336112249029, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/819c7a", "title": "Chicken &amp; ham sandwich pies", "source_url": "http://www.bbcgoodfood.com/recipes/1403640/chicken-and-ham-sandwich-pies", "recipe_id": "819c7a", "image_url": "http://static.food2fork.com/1403640_MEDIUMf0f6.jpg", "social_rank": 57.35869506571309, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/10624", "title": "Crispy Crunchy Chicken Strips", "source_url": "http://allrecipes.com/Recipe/Crispy-Crunchy-Chicken-Strips/Detail.aspx", "recipe_id": "10624", "image_url": "http://static.food2fork.com/8052750e2e.jpg", "social_rank": 48.80530293498088, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/c82344", "title": "Four &amp; twenty chicken &amp; ham pie", "source_url": "http://www.bbcgoodfood.com/recipes/2762678/four-and-twenty-chicken-and-ham-pie", "recipe_id": "c82344", "image_url": "http://static.food2fork.com/2762678_MEDIUM6186.jpg", "social_rank": 47.57327788473348, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/519", "title": "&#34;Pantry Raid&#34; Chicken Enchilada Casserole", "source_url": "http://allrecipes.com/Recipe/Pantry-Raid-Chicken-Enchilada-Casserole/Detail.aspx", "recipe_id": "519", "image_url": "http://static.food2fork.com/8368150356.jpg", "social_rank": 47.4115523494645, "publisher_url": "http://allrecipes.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/e31b11", "title": "Baked Honey Nut Chicken", "source_url": "http://allrecipes.com/Recipe/Baked-Honey-Nut-Chicken/Detail.aspx", "recipe_id": "e31b11", "image_url": "http://static.food2fork.com/64461e0fa.jpg", "social_rank": 44.36064851437235, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/aa3374", "title": "Caribbean BBQ Patties", "source_url": "http://www.bbcgoodfood.com/recipes/1644634/caribbean-bbq-patties", "recipe_id": "aa3374", "image_url": "http://static.food2fork.com/1066129_medium5a98.jpg", "social_rank": 43.990595311222, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "What\'s Gaby Cooking", "f2f_url": "http://food2fork.com/view/2ae036", "title": "Chicken Piccata", "source_url": "http://whatsgabycooking.com/chicken-piccata/", "recipe_id": "2ae036", "image_url": "http://static.food2fork.com/IMG_0971209e.jpg", "social_rank": 42.98054251543119, "publisher_url": "http://whatsgabycooking.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/7301", "title": "Chicken Meatball Soup", "source_url": "http://allrecipes.com/Recipe/Chicken-Meatball-Soup/Detail.aspx", "recipe_id": "7301", "image_url": "http://static.food2fork.com/11115fd4.jpg", "social_rank": 40.82743438986167, "publisher_url": "http://allrecipes.com"}, {"publisher": "BBC Good Food", "f2f_url": "http://food2fork.com/view/bcddbc", "title": "Crunchy chicken strips", "source_url": "http://www.bbcgoodfood.com/recipes/5071/crunchy-chicken-strips", "recipe_id": "bcddbc", "image_url": "http://static.food2fork.com/5071_MEDIUMc570.jpg", "social_rank": 38.58882214853294, "publisher_url": "http://www.bbcgoodfood.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/7375", "title": "Chicken Piccata I", "source_url": "http://allrecipes.com/Recipe/Chicken-Piccata-I/Detail.aspx", "recipe_id": "7375", "image_url": "http://static.food2fork.com/775766dbbc.jpg", "social_rank": 38.58334825401263, "publisher_url": "http://allrecipes.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/32664", "title": "Three Pepper Chicken", "source_url": "http://allrecipes.com/Recipe/Three-Pepper-Chicken/Detail.aspx", "recipe_id": "32664", "image_url": "http://static.food2fork.com/294182c694.jpg", "social_rank": 37.296487944001576, "publisher_url": "http://allrecipes.com"}, {"publisher": "Fine Dining Lovers", "f2f_url": "http://food2fork.com/view/54016", "title": "Chicken And Shrimp Salad With Vegetables And Noodles", "source_url": "http://www.finedininglovers.com/recipes/brunch/asian-noodle-salad-recipe/", "recipe_id": "54016", "image_url": "http://static.food2fork.com/s_1494_chickenshrimpnoodlesaladCUT16e97.jpg", "social_rank": 36.74270627824756, "publisher_url": "http://www.finedininglovers.com"}, {"publisher": "Cookstr", "f2f_url": "http://food2fork.com/view/45970", "title": "Pineapple Fried Rice", "source_url": "http://www.cookstr.com/recipes/pineapple-fried-rice", "recipe_id": "45970", "image_url": "http://static.food2fork.com/recipe19925e0d3.jpg", "social_rank": 36.62681759006754, "publisher_url": "http://www.cookstr.com"}, {"publisher": "Fine Dining Lovers", "f2f_url": "http://food2fork.com/view/53773", "title": "Asian Cashewnuts and Chicken Stir Fry", "source_url": "http://www.finedininglovers.com/recipes/main-course/cashewnuts-chicken-stir-fry/", "recipe_id": "53773", "image_url": "http://static.food2fork.com/s_3605_StockFood00166777cut5816.jpg", "social_rank": 36.61058866469593, "publisher_url": "http://www.finedininglovers.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/7686", "title": "Chili And Cheese Stuffed Chicken Breasts", "source_url": "http://allrecipes.com/Recipe/Chili-And-Cheese-Stuffed-Chicken-Breasts/Detail.aspx", "recipe_id": "7686", "image_url": "http://static.food2fork.com/5042754ad0.jpg", "social_rank": 36.27011876765954, "publisher_url": "http://allrecipes.com"}, {"publisher": "All Recipes", "f2f_url": "http://food2fork.com/view/1b6c2d", "title": "My Chicken Parmesan", "source_url": "http://allrecipes.com/Recipe/My-Chicken-Parmesan/Detail.aspx", "recipe_id": "1b6c2d", "image_url": "http://static.food2fork.com/1002005b5ee.jpg", "social_rank": 34.94538081677452, "publisher_url": "http://allrecipes.com"}]}'

    def mock_requests_get(uri, *args, **kwargs):
        obj = type('MockedResp', (), {})()
        obj.status_code = 200
        obj.content = test_json
        return obj

    monkeypatch.setattr(requests, 'get', mock_requests_get)
    recipes = RecipeQuest.find_recipes(['eggs', 'milk'])
    assert 'recipes' in recipes
    assert 'publisher' in recipes['recipes'][0]


def test_find_recipes_no_content(monkeypatch):
    def mock_requests_get(uri, *args, **kwargs):
        obj = type('MockedResp', (), {})()
        obj.status_code = 200
        obj.content = ''
        return obj

    monkeypatch.setattr(requests, 'get', mock_requests_get)
    recipes = RecipeQuest.find_recipes(['eggs', 'milk'])
    assert recipes == []



